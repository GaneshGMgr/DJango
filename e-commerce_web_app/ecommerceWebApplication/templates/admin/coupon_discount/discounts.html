{% extends "admin/admin_base.html" %}

{% block title %}Discount Management{% endblock %}

{% block adminbody %}

{% if request.user.is_authenticated and request.user.is_staff and request.user.is_active %}

<div class="container-fluid py-4">
    <!-- Stats Cards Row -->
    <div class="row g-4 mb-4">
        <!-- Active Discounts -->
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card stat-card shadow-sm" style="border-left: 4px solid #28a745;">
                <div class="card-body">
                    <h6 class="text-muted small text-uppercase fw-bold">Active Discounts</h6>
                    <h3 class="fw-bold mb-1">{{ active_discounts }}</h3>
                    <div class="text-success small">
                        <i class="fas fa-percentage me-1"></i> Currently Running
                    </div>
                </div>
            </div>
        </div>

        <!-- Scheduled Discounts -->
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card stat-card shadow-sm" style="border-left: 4px solid #ffc107;">
                <div class="card-body">
                    <h6 class="text-muted small text-uppercase fw-bold">Scheduled</h6>
                    <h3 class="fw-bold mb-1">{{ scheduled_discounts }}</h3>
                    <div class="text-warning small">
                        <i class="fas fa-clock me-1"></i> Future Promotions
                    </div>
                </div>
            </div>
        </div>

        <!-- Discounted Products -->
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card stat-card shadow-sm" style="border-left: 4px solid #17a2b8;">
                <div class="card-body">
                    <h6 class="text-muted small text-uppercase fw-bold">Discounted Products</h6>
                    <h3 class="fw-bold mb-1">{{ discounted_products }}</h3>
                    <div class="text-info small">
                        <i class="fas fa-tag me-1"></i> On Sale Now
                    </div>
                </div>
            </div>
        </div>

        <!-- Avg Discount Value -->
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card stat-card shadow-sm" style="border-left: 4px solid #6f42c1;">
                <div class="card-body">
                    <h6 class="text-muted small text-uppercase fw-bold">Avg. Discount</h6>
                    <h3 class="fw-bold mb-1">{{ avg_discount_value }}%</h3>
                    <div class="text-primary small">
                        <i class="fas fa-chart-line me-1"></i> Average Savings
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Discounts Table -->
    <div class="card mb-4 border-0 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center bg-white border-bottom">
            <div>
                <h5 class="mb-0"><i class="fas fa-percent me-2 text-primary"></i> Product Discounts</h5>
                <p class="small text-muted mb-0">Last updated: {{ last_updated }}</p>
            </div>
            <div>
                <button class="btn btn-sm btn-outline-secondary me-2" id="exportBtn">
                    <i class="fas fa-download me-1"></i> Export
                </button>
                <button class="btn btn-sm btn-primary" id="addDiscountBtn" data-bs-toggle="modal" data-bs-target="#discountModal">
                    <i class="fas fa-plus me-1"></i> Create Discount
                </button>
            </div>
        </div>
        
        <!-- Search and Filter Section -->
        <div class="card-body border-bottom bg-light">
            <div class="row g-3 align-items-center">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search discounts...">
                    </div>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="statusFilter">
                        <option value="all">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="expired">Expired</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="typeFilter">
                        <option value="all">All Types</option>
                        <option value="percentage">Percentage</option>
                        <option value="fixed">Fixed Amount</option>
                        <option value="bundle">Bundle Deal</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="categoryFilter">
                        <option value="all">All Categories</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2 d-flex gap-2">
                    <button class="btn btn-outline-primary flex-grow-1" id="applyFiltersBtn">
                        <i class="fas fa-filter me-1"></i> Apply
                    </button>
                    <button class="btn btn-outline-secondary" id="resetFiltersBtn">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Bulk Action Panel (hidden by default) -->
        <div id="bulkActionPanel" class="bg-light p-3 border-bottom" style="display: none;">
            <div class="d-flex align-items-center">
                <span class="me-3" id="selectedCount">0 discounts selected</span>
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-danger" id="bulkDeleteBtn">
                        <i class="fas fa-trash me-1"></i> Delete
                    </button>
                    <button class="btn btn-sm btn-outline-success" id="bulkActivateBtn">
                        <i class="fas fa-play me-1"></i> Activate
                    </button>
                    <button class="btn btn-sm btn-outline-warning" id="bulkDeactivateBtn">
                        <i class="fas fa-pause me-1"></i> Pause
                    </button>
                </div>
                <button class="btn btn-sm btn-link text-danger" id="clearSelectionBtn">
                    <i class="fas fa-times me-1"></i> Clear
                </button>
            </div>
        </div>
        
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="discountsTable">
                    <thead class="table-light">
                        <tr>
                            <th width="50">
                                <input type="checkbox" id="selectAllCheckbox" class="form-check-input">
                            </th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Products</th>
                            <th>Valid Dates</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Active Discount -->
                        <tr>
                            <td>
                                <input type="checkbox" class="form-check-input row-checkbox" data-id="1">
                            </td>
                            <td class="fw-bold">Summer Sale</td>
                            <td><span class="badge bg-primary bg-opacity-10 text-primary">Percentage</span></td>
                            <td>20%</td>
                            <td>
                                <span class="badge bg-light text-dark">12 products</span>
                            </td>
                            <td>
                                <small>Jun 1 - Jun 30, 2023</small>
                            </td>
                            <td><span class="badge bg-success bg-opacity-10 text-success">Active</span></td>
                            <td>May 15, 2023</td>
                            <td class="text-center">
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        Actions
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item edit-discount-btn" href="#" data-id="1"><i class="fas fa-edit me-2"></i> Edit</a></li>
                                        <li><a class="dropdown-item view-products-btn" href="#" data-id="1"><i class="fas fa-boxes me-2"></i> View Products</a></li>
                                        <li><a class="dropdown-item view-performance-btn" href="#" data-id="1"><i class="fas fa-chart-bar me-2"></i> Performance</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger delete-discount-btn" href="#" data-id="1"><i class="fas fa-trash me-2"></i> Delete</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Scheduled Discount -->
                        <tr class="table-info">
                            <td>
                                <input type="checkbox" class="form-check-input row-checkbox" data-id="2">
                            </td>
                            <td class="fw-bold">Back to School</td>
                            <td><span class="badge bg-info bg-opacity-10 text-info">Bundle</span></td>
                            <td>Buy 2 Get 1 Free</td>
                            <td>
                                <span class="badge bg-light text-dark">8 products</span>
                            </td>
                            <td>
                                <small>Aug 15 - Sep 5, 2023</small>
                            </td>
                            <td><span class="badge bg-info bg-opacity-10 text-info">Scheduled</span></td>
                            <td>Jul 20, 2023</td>
                            <td class="text-center">
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        Actions
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item edit-discount-btn" href="#" data-id="2"><i class="fas fa-edit me-2"></i> Edit</a></li>
                                        <li><a class="dropdown-item view-products-btn" href="#" data-id="2"><i class="fas fa-boxes me-2"></i> View Products</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger delete-discount-btn" href="#" data-id="2"><i class="fas fa-trash me-2"></i> Delete</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Expired Discount -->
                        <tr class="table-secondary">
                            <td>
                                <input type="checkbox" class="form-check-input row-checkbox" data-id="3">
                            </td>
                            <td class="fw-bold">Spring Clearance</td>
                            <td><span class="badge bg-warning bg-opacity-10 text-warning">Fixed</span></td>
                            <td>$15 Off</td>
                            <td>
                                <span class="badge bg-light text-dark">24 products</span>
                            </td>
                            <td>
                                <small>Mar 1 - May 31, 2023</small>
                            </td>
                            <td><span class="badge bg-danger bg-opacity-10 text-danger">Expired</span></td>
                            <td>Feb 15, 2023</td>
                            <td class="text-center">
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        Actions
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item edit-discount-btn" href="#" data-id="3"><i class="fas fa-edit me-2"></i> Edit</a></li>
                                        <li><a class="dropdown-item view-products-btn" href="#" data-id="3"><i class="fas fa-boxes me-2"></i> View Products</a></li>
                                        <li><a class="dropdown-item view-performance-btn" href="#" data-id="3"><i class="fas fa-chart-bar me-2"></i> Performance</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger delete-discount-btn" href="#" data-id="3"><i class="fas fa-trash me-2"></i> Delete</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer bg-white d-flex justify-content-between align-items-center">
            <div>
                <select class="form-select form-select-sm w-auto d-inline-block me-2" id="itemsPerPage">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span class="text-muted small">discounts per page</span>
            </div>
            <nav>
                <ul class="pagination pagination-sm mb-0" id="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" id="prevPage"><i class="fas fa-chevron-left"></i></a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#" id="nextPage"><i class="fas fa-chevron-right"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Discount Modal -->
<div class="modal fade" id="discountModal" tabindex="-1" aria-labelledby="discountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1e293b; color: white; border-bottom: 1px solid #334155;">
                <h5 class="modal-title">Create New Discount</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="discountForm">
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label for="discountName" class="form-label">Discount Name *</label>
                            <input type="text" class="form-control" id="discountName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="discountType" class="form-label">Discount Type *</label>
                            <select class="form-select" id="discountType" required>
                                <option value="">Select Type</option>
                                <option value="percentage">Percentage Discount</option>
                                <option value="fixed">Fixed Amount Discount</option>
                                <option value="bundle">Bundle Deal</option>
                                <option value="free_shipping">Free Shipping</option>
                            </select>
                        </div>
                        <div class="col-md-6" id="discountValueContainer">
                            <label for="discountValue" class="form-label">Discount Value *</label>
                            <div class="input-group">
                                <span class="input-group-text" id="valueSymbol">%</span>
                                <input type="number" class="form-control" id="discountValue" min="1">
                            </div>
                        </div>
                        <div class="col-md-6" id="bundleDealContainer" style="display: none;">
                            <label for="bundleDeal" class="form-label">Bundle Deal *</label>
                            <select class="form-select" id="bundleDeal">
                                <option value="buy_x_get_y">Buy X Get Y Free</option>
                                <option value="buy_x_get_discount">Buy X Get Discount</option>
                                <option value="free_gift">Free Gift with Purchase</option>
                            </select>
                        </div>
                        <div class="col-md-6" id="bundleDetailsContainer" style="display: none;">
                            <label for="bundleDetails" class="form-label">Details *</label>
                            <input type="text" class="form-control" id="bundleDetails" placeholder="e.g. Buy 2 Get 1 Free">
                        </div>
                        <div class="col-md-6">
                            <label for="validFrom" class="form-label">Valid From *</label>
                            <input type="datetime-local" class="form-control" id="validFrom" required>
                        </div>
                        <div class="col-md-6">
                            <label for="validTo" class="form-label">Valid To *</label>
                            <input type="datetime-local" class="form-control" id="validTo" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Apply To *</label>
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="applyTo" id="applyAll" checked>
                                        <label class="form-check-label" for="applyAll">All Products</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="applyTo" id="applyCategory">
                                        <label class="form-check-label" for="applyCategory">Specific Categories</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="applyTo" id="applyProducts">
                                        <label class="form-check-label" for="applyProducts">Specific Products</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12" id="categoriesContainer" style="display: none;">
                            <label class="form-label">Select Categories</label>
                            <div class="row g-2">
                                {% for category in categories %}
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="cat-{{ category.id }}">
                                        <label class="form-check-label" for="cat-{{ category.id }}">{{ category.name }}</label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-12" id="productsContainer" style="display: none;">
                            <label class="form-label">Select Products</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text bg-white"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" placeholder="Search products...">
                                <button class="btn btn-outline-secondary" type="button">Search</button>
                            </div>
                            <div class="border p-2" style="max-height: 200px; overflow-y: auto;">
                                <!-- Products would be loaded here via AJAX -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="prod-1">
                                    <label class="form-check-label" for="prod-1">Wireless Headphones</label>
                                </div>
                                <!-- More products would be listed here -->
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="discountDescription" class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="discountDescription" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveDiscountBtn">Save Discount</button>
            </div>
        </div>
    </div>
</div>

<!-- Products Modal -->
<div class="modal fade" id="productsModal" tabindex="-1" aria-labelledby="productsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productsModalLabel">Products in Discount</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Original Price</th>
                                <th>Discounted Price</th>
                                <th>Savings</th>
                                <th>Sales</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="https://via.placeholder.com/40" width="40" height="40" class="rounded me-2">
                                        <div>Wireless Headphones</div>
                                    </div>
                                </td>
                                <td>$99.99</td>
                                <td>$79.99</td>
                                <td class="text-success">20%</td>
                                <td>45</td>
                            </tr>
                            <!-- More products would be listed here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Performance Modal -->
<div class="modal fade" id="performanceModal" tabindex="-1" aria-labelledby="performanceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="performanceModalLabel">Discount Performance</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="text-muted">Total Revenue</h6>
                                <h3>$2,450.00</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="text-muted">Units Sold</h6>
                                <h3>124</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="text-muted">Conversion Rate</h6>
                                <h3>8.7%</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Sales Over Time</h6>
                        <div style="height: 300px;">
                            <!-- Chart would be rendered here -->
                            <img src="https://via.placeholder.com/800x300?text=Sales+Chart" class="img-fluid">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Top Performing Products</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Units Sold</th>
                                        <th>Revenue</th>
                                        <th>Conversion</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Wireless Headphones</td>
                                        <td>45</td>
                                        <td>$3,599.55</td>
                                        <td>12.4%</td>
                                    </tr>
                                    <!-- More products would be listed here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-outline-primary">
                    <i class="fas fa-download me-1"></i> Export Report
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');
        const rowCheckboxes = document.querySelectorAll('.row-checkbox');
        const bulkActionPanel = document.getElementById('bulkActionPanel');
        const selectedCount = document.getElementById('selectedCount');
        const clearSelectionBtn = document.getElementById('clearSelectionBtn');
        const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
        const bulkActivateBtn = document.getElementById('bulkActivateBtn');
        const bulkDeactivateBtn = document.getElementById('bulkDeactivateBtn');
        const discountModal = new bootstrap.Modal(document.getElementById('discountModal'));
        const productsModal = new bootstrap.Modal(document.getElementById('productsModal'));
        const performanceModal = new bootstrap.Modal(document.getElementById('performanceModal'));
        const discountTypeSelect = document.getElementById('discountType');
        const applyToRadios = document.querySelectorAll('input[name="applyTo"]');
        
        // Toggle discount value fields based on type
        discountTypeSelect.addEventListener('change', function() {
            const type = this.value;
            document.getElementById('discountValueContainer').style.display = 
                (type === 'percentage' || type === 'fixed') ? 'block' : 'none';
            document.getElementById('bundleDealContainer').style.display = 
                type === 'bundle' ? 'block' : 'none';
            document.getElementById('bundleDetailsContainer').style.display = 
                type === 'bundle' ? 'block' : 'none';
            
            if (type === 'percentage') {
                document.getElementById('valueSymbol').textContent = '%';
            } else if (type === 'fixed') {
                document.getElementById('valueSymbol').textContent = '$';
            }
        });
        
        // Toggle product/category selectors
        applyToRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('categoriesContainer').style.display = 
                    this.id === 'applyCategory' ? 'block' : 'none';
                document.getElementById('productsContainer').style.display = 
                    this.id === 'applyProducts' ? 'block' : 'none';
            });
        });
        
        // Select All functionality
        selectAllCheckbox.addEventListener('change', function() {
            const isChecked = this.checked;
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            updateBulkActionPanel();
        });
    
        // Individual row checkbox functionality
        rowCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateBulkActionPanel);
        });
    
        // Clear selection
        clearSelectionBtn.addEventListener('click', function() {
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectAllCheckbox.checked = false;
            bulkActionPanel.style.display = 'none';
        });
    
        // Bulk delete action
        bulkDeleteBtn.addEventListener('click', function() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length > 0) {
                if (confirm(`Are you sure you want to delete ${selectedIds.length} selected discounts?`)) {
                    alert(`Deleted discounts with IDs: ${selectedIds.join(', ')}`);
                    // In a real app, you would make an AJAX call here
                }
            }
        });
    
        // Bulk activate action
        bulkActivateBtn.addEventListener('click', function() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length > 0) {
                alert(`Activating discounts with IDs: ${selectedIds.join(', ')}`);
                // In a real app, you would make an AJAX call here
            }
        });
        
        // Bulk deactivate action
        bulkDeactivateBtn.addEventListener('click', function() {
            const selectedIds = getSelectedIds();
            if (selectedIds.length > 0) {
                alert(`Deactivating discounts with IDs: ${selectedIds.join(', ')}`);
                // In a real app, you would make an AJAX call here
            }
        });
        
        // View products button click handlers
        document.querySelectorAll('.view-products-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const discountId = this.getAttribute('data-id');
                // In a real app, you would fetch discount products data here
                productsModal.show();
            });
        });
        
        // View performance button click handlers
        document.querySelectorAll('.view-performance-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const discountId = this.getAttribute('data-id');
                // In a real app, you would fetch performance data here
                performanceModal.show();
            });
        });
        
        // Edit discount button click handlers
        document.querySelectorAll('.edit-discount-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const discountId = this.getAttribute('data-id');
                // In a real app, you would fetch discount data here
                document.getElementById('discountModalLabel').textContent = 'Edit Discount';
                discountModal.show();
            });
        });
    
        // Helper function to update bulk action panel visibility
        function updateBulkActionPanel() {
            const checkedCount = document.querySelectorAll('.row-checkbox:checked').length;
            if (checkedCount > 0) {
                bulkActionPanel.style.display = 'block';
                selectedCount.textContent = `${checkedCount} discounts selected`;
                selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < rowCheckboxes.length;
            } else {
                bulkActionPanel.style.display = 'none';
                selectAllCheckbox.indeterminate = false;
            }
        }
    
        // Helper function to get selected IDs
        function getSelectedIds() {
            const selectedIds = [];
            document.querySelectorAll('.row-checkbox:checked').forEach(checkbox => {
                selectedIds.push(checkbox.getAttribute('data-id'));
            });
            return selectedIds;
        }
    });
</script>

{% endif %}
{% endblock %}